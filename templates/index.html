<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Cart Tracker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .cart { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 5px; }
        textarea { width: 100%; height: 40px; }

        /* Barra fija */
        .fixed-summary {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f4f4f4;
            padding: 10px 20px;
            border-bottom: 2px solid #ccc;
            z-index: 1000;
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-items: center;
            gap: 10px;
        }

        .fixed-summary h2 { margin: 0 20px 0 0; font-size: 1.2em; }

        /* Categorías como botones */
        .status-item { 
            margin: 0 10px; 
            font-size: 0.95em; 
            cursor: pointer; 
            background-color: #ff9800; 
            color: white;              
            padding: 5px 12px;         
            border-radius: 12px;       
            text-decoration: none; 
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .status-item:hover { background-color: #e68900; }

        body { margin-top: 150px; }

        /* Modal */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888;
            width: 80%; max-width: 400px; border-radius: 8px; text-align: center;
        }

        .modal-content button { margin-top: 15px; padding: 5px 15px; }

        /* Botón SAVE */
        .save-top { 
            margin-left: 20px; 
            padding: 10px 20px;          
            border-radius: 12px;         
            background-color: #28a745;    
            color: white;                 
            border: none;                 
            cursor: pointer;              
            font-weight: bold;
            font-size: 1em;
        }

        .save-top:hover { background-color: #218838; }

        /* Botón HISTORY */
        .history-top {
            margin-left: 10px;
            padding: 10px 18px;
            border-radius: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
        }
        .history-top:hover { background-color: #0069d9; }
    </style>
</head>
<body>
    <h1>Golf Cart Tracker</h1>

    <!-- Barra fija con categorías y SAVE + HISTORY-->
    <div class="fixed-summary">
        <h2>Status Summary:</h2>
        {% for status, count in counts.items() %}
            <div class="status-item" onclick="showCategory('{{status}}')">
                <strong>{{status}}</strong>: {{count}}
            </div>
        {% endfor %}
        <button class="save-top" onclick="saveChanges()">SAVE</button>
        <button class="history-top" onclick="goHistory()">HISTORY</button>
    </div>

    <form id="cart-form" method="POST">
        {% for cart in carts %}
            <div class="cart">
                <h3>{{cart}}</h3>
                <label>Status: </label>
                <select name="status_{{cart}}">
                    {% for option in status_options %}
                        <option value="{{option}}" {% if cart_states[cart]['status'] == option %}selected{% endif %}>
                            {{option}}
                        </option>
                    {% endfor %}
                </select>
                <br><br>
                <label>Comment:</label><br>
                <textarea name="comment_{{cart}}">{{cart_states[cart]['comment']}}</textarea>
            </div>
        {% endfor %}
    </form>

    <!-- Modal para categorías -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title"></h3>
            <ul id="modal-list"></ul>
            <button onclick="closeModal()">OK</button>
        </div>
    </div>

    <script>
        // Ir a la página de historial
        function goHistory() {
            window.location.href = "/history";
        }

        // Mostrar modal de categoría
        function showCategory(status) {
            fetch(`/category/${status}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('modal-title').innerText = `SunCarts ${status}:`;
                const list = document.getElementById('modal-list');
                list.innerHTML = '';
                data.forEach(cart => {
                    const li = document.createElement('li');
                    li.innerText = cart;
                    list.appendChild(li);
                });
                document.getElementById('category-modal').style.display = 'block';
            });
        }

        function closeModal() {
            document.getElementById('category-modal').style.display = 'none';
        }

        // Botón SAVE con confirmación verde/rojo
        function saveChanges() {
            const form = document.getElementById('cart-form');
            fetch('/', {
                method: 'POST',
                body: new FormData(form)
            })
            .then(response => {
                if (response.ok) {
                    showSaveConfirmation("Changes have been saved successfully!", true);
                } else {
                    showSaveConfirmation("Error: Changes could not be saved!", false);
                }
            })
            .catch(() => {
                showSaveConfirmation("Error: Changes could not be saved!", false);
            });
        }

        // Mensaje de confirmación
        function showSaveConfirmation(message, success) {
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '20px';
            modal.style.left = '50%';
            modal.style.transform = 'translateX(-50%)';
            modal.style.backgroundColor = success ? '#28a745' : '#dc3545';
            modal.style.color = 'white';
            modal.style.padding = '10px 20px';
            modal.style.borderRadius = '8px';
            modal.style.zIndex = 3000;
            modal.innerText = message;

            document.body.appendChild(modal);

            setTimeout(() => {
                document.body.removeChild(modal);
            }, 3000);
        }
    </script>
</body>
</html>
